function AuditLogService(t,e,r,n,a){function c(t,e){return r({method:"DELETE",url:u+"?dateStart="+t+"&dateEnd="+e,headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(t){return t.data}).catch(function(t){return i(t,"deleteAuditLogs")})}function o(t,e){return r.get(u+"?dateStart="+t+"&dateEnd="+e).then(function(t){return t.data}).catch(function(t){return i(t,"getAuditLogs")})}function i(t,r){var n="XHR Failed for "+r;return t.data&&t.data.error&&(n=n+"\n"+t.data.error),t.data&&t.data.description&&(n=n+"\n"+t.data.description),t.data?t.data.detail=n:t.data={error:"SERVER_ERROR",description:t.statusText},e.error(n),a.reject(t)}var u="/auditLogs";return{deleteAuditLogs:c,getAuditLogs:o}}function AuthService(t,e,r,n,a){function c(e,r){var n="XHR Failed for "+r;return e.data&&e.data.error&&(n=n+"\n"+e.data.error),e.data&&e.data.description&&(n=n+"\n"+e.data.description),e.data?e.data.detail=n:e.data={error:"SERVER_ERROR",description:e.statusText},t.error(n),a.reject(e)}function o(){return e.get("/profile").then(function(t){return n.user=t.data.user}).catch(function(t){return c(t,"getCurrentUser")})}var i={};return i.login=function(t){return e.post("/login",t).then(function(t){return n.user=t.data.user}).catch(function(t){return c(t,"login")})},i.logout=function(){delete n.user,r.location.href="/logout"},i.getCurrentUser=function(){return n.user?a.when(n.user):o()},i.isAuthenticated=function(){return!!n.user},i.isAuthorized=function(t){return angular.isArray(t)||(t=[t]),i.isAuthenticated()&&-1!==t.indexOf(n.user.idRole)},i}function BacthService(t,e,r,n,a,c,o){function i(){var t=d();t?p(t.id):u()}function u(){batchPoller&&(batchPoller.stop(),batchPoller=null)}function s(t){return r.get(v+"/update/multiple/"+t,{timeout:1e4,cache:!1}).then(function(t){return t.data}).catch(function(t){return h(t,"getBatchStatus")})}function d(){return a.batchData}function l(e){if(!batchPoller){return batchPoller=c.poll(v+"/update/multiple/"+e,function(e){var r=e.batch;if(r){if(r.total==r.completed+r.failed)return r=null,f(null),void t.$broadcast(o.statusSuccess,{data:r});if(new Date-new Date(r.createdAt)>3e5)return r=null,f(null),void t.$broadcast(o.statusSuccess,{data:r})}t.$broadcast(o.statusSuccess,{data:r})},function(e){t.$broadcast(o.statusFailed,{message:e.data.error,description:e.data.description}),f(null)},1e4,5e3)}}function f(t){a.batchData=t,i()}function p(t){batchPoller||l(t),batchPoller.start()}function h(t,r){var a="XHR Failed for "+r;return t.data&&t.data.error&&(a=a+"\n"+t.data.error),t.data&&t.data.description&&(a=a+"\n"+t.data.description),t.data?t.data.detail=a:t.data={error:"SERVER_ERROR",description:t.statusText},e.error(a),n.reject(t)}var v="/devices";return{checkBatchStatus:i,getBatchStatus:s,getLocalBatchData:d,setLocalBatchData:f}}function DevicesService(t,e,r,n,a){function c(){return r.get($+"/sync",{timeout:1e4,cache:!1}).then(function(t){return t.data}).catch(function(t){return m(t,"sync")})}function o(t){return r.get($+"/"+t).then(function(t){return t.data}).catch(function(t){return m(t,"getDevice")})}function i(){return r.get($).then(function(t){return t.data}).catch(function(t){return m(t,"getDevices")})}function u(t){return r.post($,t).then(function(t){return t.data}).catch(function(t){return m(t,"createDevice")})}function s(t,e){return r.put($+"/"+t,e).then(function(t){return t.data}).catch(function(t){return m(t,"updateDevice")})}function d(t,e){return r({method:"DELETE",url:$+"/"+t,data:e,headers:{"Content-type":"application/json;charset=utf-8"}}).then(function(t){return t.data}).catch(function(t){return m(t,"deleteDevice")})}function l(t){return r.get($+"/config/"+t).then(function(t){return t.data}).catch(function(t){return m(t,"getDeviceConfig")})}function f(t){return r.get($+"/log/"+t).then(function(t){return t.data}).catch(function(t){return m(t,"getDeviceLog")})}function p(t){return r.get($+"/status/"+t).then(function(t){return t.data}).catch(function(t){return m(t,"getDeviceStatus")})}function h(t){return r.get("maintenance/"+t).then(function(t){return t.data}).catch(function(t){return m(t,"getMaintenance")})}function v(){return r.get($+"/import/report").then(function(t){return t.data}).catch(function(t){return m(t,"getBulkImportReport")})}function g(){return a.get($+"/import/report",{delay:2e3,catchError:!0,smart:!0,argumentsArray:[{timeout:1e4,cache:!1}]})}function S(t,e){return r.post("maintenance/schedule/"+t,e).then(function(t){return t.data}).catch(function(t){return m(t,"scheduleMaintenance")})}function D(t,e){return r.post("maintenance/remove/"+t,e).then(function(t){return t.data}).catch(function(t){return m(t,"removeMaintenance")})}function y(t){return r.post("commands/",t).then(function(t){return t.data}).catch(function(t){return m(t,"sendCommand")})}function R(t){return r.post($+"/update/multiple/",t).then(function(t){return t.data}).catch(function(t){return m(t,"updateDevices")})}function m(t,r){var a="XHR Failed for "+r;return t.data&&t.data.error&&(a=a+"\n"+t.data.error),t.data&&t.data.description&&(a=a+"\n"+t.data.description),t.data?t.data.detail=a:t.data={error:"SERVER_ERROR",description:t.statusText},e.error(a),n.reject(t)}var $="/devices";return{createDevice:u,deleteDevice:d,getBulkImportReport:v,getBulkImportReportPoller:g,getDevice:o,getDeviceConfig:l,getDeviceLog:f,getDeviceStatus:p,getDevices:i,getMaintenance:h,removeMaintenance:D,scheduleMaintenance:S,sendCommand:y,sync:c,updateDevice:s,updateDevices:R}}function fileUploadService(t,e,r){function n(e,r,n){var a="XHR Failed for "+n;return e.data||(e.data={error:r?r.error:"SERVER_ERROR",description:r?r.description:""}),e.data&&e.data.error&&(a=a+"\n"+e.data.error),e.data&&e.data.description&&(a=a+"\n"+e.data.description),e.data&&(e.data.detail=a),t.error(a),e}function a(t,e,r,a,c){if(e.length>0){for(var o=new FormData,i=0;i<e.length;i++){var u=e[i];o.append("uploads[]",u,u.name)}var s=new XMLHttpRequest;s.upload.onprogress=function(t){r&&"function"==typeof r&&r(t)},s.onload=function(t){if(200!=s.status){var r=n(t,s.responseText?JSON.parse(s.responseText):null,"upload");return c&&"function"==typeof c&&c(r),!1}var o={files:e,data:s.responseText?JSON.parse(s.responseText):null};a&&"function"==typeof a&&a(o)},s.upload.onerror=function(t){var e=n(t,s.responseText?JSON.parse(s.responseText):null,"upload");c&&"function"==typeof c&&c(e)},s.open("POST",t),s.send(o)}}return{upload:a}}function groupsService(t,e,r){function n(e,n){var a="XHR Failed for "+n;return e.data&&e.data.error&&(a=a+"\n"+e.data.error),e.data&&e.data.description&&(a=a+"\n"+e.data.description),e.data?e.data.detail=a:e.data={error:"SERVER_ERROR",description:e.statusText},t.error(a),r.reject(e)}return{listGroups:function(){return e.get("/groups").then(function(t){return t.data}).catch(function(t){return n(t,"listGroups")})},getGroup:function(t){return e.get("/groups/"+t).then(function(t){return t.data}).catch(function(t){return n(t,"getGroup")})},createGroup:function(t){return e.post("/groups",t).then(function(t){return t.data}).catch(function(t){return n(t,"createGroup")})},updateGroup:function(t){return e.put("/groups",t).then(function(t){return t.data}).catch(function(t){return n(t,"updateGroup")})},deleteGroups:function(t){return e({method:"DELETE",url:"/groups",data:{groupIds:t},headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(t){return t.data}).catch(function(t){return n(t,"deleteGroups")})}}}function dataHttpInterceptor(t,e,r,n,a){return{request:function(e){return t.$broadcast(a.appLoading,{loading:!0}),t.isIE11&&(e.headers||(e.headers={}),e.headers["Cache-Control"]="no-cache",e.headers.Pragma="no-cache"),e},requestError:function(r){return t.$broadcast(a.appLoading,{loading:!1}),canRecover(r)?responseOrNewPromise:e.reject(r)},response:function(e){return t.$broadcast(a.appLoading,{loading:!1}),e},responseError:function(r){return t.$broadcast(a.appLoading,{loading:!1}),t.$broadcast({401:n.notAuthenticated,403:n.notAuthorized}[r.status],r),e.reject(r)}}}function kibanaService(t,e,r){function n(e,n){var a="XHR Failed for "+n;return e.data&&e.data.error&&(a=a+"\n"+e.data.error),e.data&&e.data.description&&(a=a+"\n"+e.data.description),e.data?e.data.detail=a:e.data={error:"SERVER_ERROR",description:e.statusText},t.error(a),r.reject(e)}return{listDashboards:function(){return e.get("/kibana/dashboards").then(function(t){return t.data}).catch(function(t){return n(t,"getDashboards")})},getDashboardUrl:function(t,r){var a="/kibana/"+t;return void 0!==r&&(a+="/"+r),e.get(a).then(function(t){return t.data}).catch(function(t){return n(t,"getDashboardUrl")})},filterChart:function(t,r,a){var c="/kibana/"+t;return void 0!==a&&(c+="/"+a),e.post(c,r).then(function(t){return t.data}).catch(function(t){return n(t,"getDashboardUrl")})}}}function leafletService(t){function e(e,r){var n=c[e];return n[r]=t.defer(),n[r]}function r(t,r){var n=c[t];return n[r]?n[r]:e(t,r)}function n(t){return r("map",t).promise}function a(t,r){e("map",r).resolve(t)}var c={map:[]};return{setMap:a,getMap:n}}function PollerService(t,e,r,n){function a(t,e,a,o,i){var u=function(t){this.interval=null,this.isRequestPendeing=!1,this.pollerInterval=t.pollerInterval||3e4,this.requestTimeout=t.requestTimeout||2e4,this.setOptions(t)};u.prototype.setOptions=function(t){this.url=t.url,null!=t.pollerInterval&&(this.pollerInterval=t.pollerInterval),null!=t.requestTimeout&&(this.requestTimeout=t.requestTimeout),this.successCallback=t.successCallback,this.errorCallback=t.errorCallback},u.prototype.start=function(){this.interval||(this.execute(),this.interval=n(function(t){return function(){t.execute()}}(this),this.pollerInterval))},u.prototype.execute=function(){if(!this.isRequestPendeing){this.isRequestPendeing=!0;var t=this;r.get(t.url,{timeout:t.requestTimeout,cache:!1}).then(function(e){t.isRequestPendeing=!1,t.successCallback&&angular.isFunction(t.successCallback)&&t.successCallback(e.data)}).catch(function(e){t.isRequestPendeing=!1;var r=c(e);t.errorCallback&&angular.isFunction(t.errorCallback)&&t.errorCallback(r)})}},u.prototype.stop=function(){this.interval&&(n.cancel(this.interval),this.interval=null),this.isRequestPendeing=!1},u.prototype.restart=function(){this.stop(),this.start()};var s=new u({url:t,successCallback:e,errorCallback:a,pollerInterval:o,requestTimeout:i});return s.start(),s}function c(t){var r="XHR Failed";return t.data&&t.data.error&&(r=r+"\n"+t.data.error),t.data&&t.data.description&&(r=r+"\n"+t.data.description),t.data?t.data.detail=r:t.data={error:"SERVER_ERROR",description:t.statusText},e.error(r),t}return{poll:a}}function StationsService(t,e,r,n,a){function c(t){return r.post(l,t).then(function(t){return t.data}).catch(function(t){return d(t,"createStation")})}function o(t,e){return r({method:"DELETE",url:l+"/"+t,data:e,headers:{"Content-type":"application/json;charset=utf-8"}}).then(function(t){return t.data}).catch(function(t){return d(t,"deleteStation")})}function i(t){return r.get(l+"/"+t).then(function(t){return t.data}).catch(function(t){return d(t,"readStation")})}function u(){return r.get(l+"/").then(function(t){return t.data}).catch(function(t){return d(t,"listStations")})}function s(t,e){return r.put(l+"/"+t,e).then(function(t){return t.data}).catch(function(t){return d(t,"updateStation")})}function d(t,r){var n="XHR Failed for "+r;return t.data&&t.data.error&&(n=n+"\n"+t.data.error),t.data&&t.data.description&&(n=n+"\n"+t.data.description),t.data?t.data.detail=n:t.data={error:"SERVER_ERROR",description:t.statusText},e.error(n),a.reject(t)}var l="/stations";return{createStation:c,deleteStation:o,readStation:i,listStations:u,updateStation:s}}function SyncService(t,e,r,n,a,c){function o(){return cachedSyncData?n.when(cachedSyncData):i()}function i(){return r.get(S+"/sync",{timeout:1e4,cache:!1}).then(function(t){return l(t.data),t.data}).catch(function(t){return g(t,"getSyncData")})}function u(){if(!syncPoller)return syncPoller=a.poll(S+"/sync",function(t){l(t)},function(e){t.$broadcast(c.syncFailed,{message:e.data.error,description:e.data.description})})}function s(){return syncPoller&&null!=syncPoller.interval}function d(){syncPoller&&syncPoller.restart()}function l(e){var r=e&&e.summary?e.summary.lastUpdate:null;null!==cacheDate&&null!==r&&r<=cacheDate||(t.$broadcast(c.syncSuccess,{data:e}),cachedSyncData=e,cacheDate=new Date)}function f(){syncPoller||u(),syncPoller.start()}function p(){syncPoller&&syncPoller.stop()}function h(t){if(t){var e=cachedSyncData||cachedSyncData.summary?cachedSyncData.summary.lastUpdate:null;if(!(null==cacheDate||null==e||e>cacheDate)){for(var r=0;r<cachedSyncData.devices.length;r++){var n=cachedSyncData.devices[r];if(n){angular.extend(n,t);break}}var a=cachedSyncData.stationsTree[t.config.stationName];if(a){var c=a.devices[t.name];c&&angular.extend(c,t)}l(cachedSyncData)}}}function v(t){if(t){var e=cachedSyncData||cachedSyncData.summary?cachedSyncData.summary.lastUpdate:null;if(!(null==cacheDate||null==e||e>cacheDate)){for(var r=0;r<cachedSyncData.stations.length;r++){var n=cachedSyncData.stations[r];if(n){angular.extend(n,t);break}}var a=cachedSyncData.stationsTree[t.name];a&&angular.extend(a,t),l(cachedSyncData)}}}function g(t,r){var a="XHR Failed for "+r;return t.data&&t.data.error&&(a=a+"\n"+t.data.error),t.data&&t.data.description&&(a=a+"\n"+t.data.description),t.data?t.data.detail=a:t.data={error:"SERVER_ERROR",description:t.statusText},e.error(a),n.reject(t)}var S="/devices";return{getCachedSyncData:o,getSyncData:i,isSyncPollerRunning:s,restartSyncPoller:d,startSyncPoller:f,stopSyncPoller:p,updateDeviceCachedData:h,updateStationCachedData:v}}function ticketsService(t,e,r){function n(e,n){var a="XHR Failed for "+n;return e.data&&e.data.error&&(a=a+"\n"+e.data.error),e.data&&e.data.description&&(a=a+"\n"+e.data.description),e.data?e.data.detail=a:e.data={error:"SERVER_ERROR",description:e.statusText},t.error(a),r.reject(e)}return{createTicket:function(t){return e.post("/tickets",t).then(function(t){return t.data}).catch(function(t){return n(t,"createTicket")})},getTickets:function(t){return e.get("/tickets/"+t).then(function(t){return t.data}).catch(function(t){return n(t,"getTickets")})},getTicket:function(t,r){return e.get("/tickets/"+r).then(function(t){return t.data}).catch(function(t){return n(t,"getTicket")})},updateTicket:function(t){return e.put("/tickets",t).then(function(t){return t.data}).catch(function(t){return n(t,"updateTicket")})},deleteTicket:function(t){return e({method:"DELETE",url:"/tickets",data:{userIds:t},headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(t){return t.data}).catch(function(t){return n(t,"deleteTickets")})}}}function usersService(t,e,r){function n(e,n){var a="XHR Failed for "+n;return e.data&&e.data.error&&(a=a+"\n"+e.data.error),e.data&&e.data.description&&(a=a+"\n"+e.data.description),e.data?e.data.detail=a:e.data={error:"SERVER_ERROR",description:e.statusText},t.error(a),r.reject(e)}return{createUser:function(t){return e.post("/users",t).then(function(t){return t.data}).catch(function(t){return n(t,"createUser")})},listUsers:function(){return e.get("/users").then(function(t){return t.data}).catch(function(t){return n(t,"listUsers")})},getUser:function(t){return e.get("/users/"+t).then(function(t){return t.data}).catch(function(t){return n(t,"getUser")})},updateUser:function(t){return e.put("/users",t).then(function(t){return t.data}).catch(function(t){return n(t,"updateUser")})},deleteUsers:function(t){return e({method:"DELETE",url:"/users",data:{userIds:t},headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(t){return t.data}).catch(function(t){return n(t,"deleteUsers")})}}}AuditLogService.$inject=["$rootScope","$log","$http","$interval","$q"],AuthService.$inject=["$log","$http","$window","$localStorage","$q"],BacthService.$inject=["$rootScope","$log","$http","$q","$localStorage","pollerService","BATCH_EVENTS"],DevicesService.$inject=["$rootScope","$log","$http","$q","poller"],fileUploadService.$inject=["$log","$http","$q"],groupsService.$inject=["$log","$http","$q"],dataHttpInterceptor.$inject=["$rootScope","$q","$log","AUTH_EVENTS","APPLICATION_EVENTS"],kibanaService.$inject=["$log","$http","$q"],PollerService.$inject=["$rootScope","$log","$http","$interval"],StationsService.$inject=["$rootScope","$log","$http","$interval","$q"],SyncService.$inject=["$rootScope","$log","$http","$q","pollerService","SYNC_EVENTS"],ticketsService.$inject=["$log","$http","$q"],usersService.$inject=["$log","$http","$q"],leafletService.$inject=["$q"];var servicesDomain=angular.module("SolariMonitor.services",[]);servicesDomain.factory("auditLogService",AuditLogService),servicesDomain.factory("AuthService",AuthService),servicesDomain.factory("bacthService",BacthService);var batchPoller=null;servicesDomain.factory("devicesService",DevicesService),servicesDomain.factory("fileUploadService",fileUploadService),servicesDomain.factory("groupsService",groupsService),servicesDomain.factory("dataHttpInterceptor",dataHttpInterceptor),servicesDomain.factory("kibanaService",kibanaService),servicesDomain.factory("leafletService",leafletService),servicesDomain.factory("pollerService",PollerService),servicesDomain.factory("stationsService",StationsService),servicesDomain.factory("syncService",SyncService);var cachedSyncData=null,cacheDate=null,syncPoller=null;servicesDomain.factory("ticketsService",ticketsService),servicesDomain.factory("usersService",usersService),servicesDomain.config(["$httpProvider",function(t){t.useApplyAsync(!0),t.interceptors.push("dataHttpInterceptor")}]);
//# sourceMappingURL=maps/services.min.js.map
