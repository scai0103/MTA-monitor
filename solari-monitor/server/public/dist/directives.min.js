function compareTo(e){function t(e,t,i,a){a.$validators.compareTo=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){a.$validate()})}return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:t}}function deviceBulkUpload(e,t,i,a,n,o,r,l,s,c){function u(e,t,n,l){function s(){e.isReportLoading=!1,f&&(f.stop(),f=null),p(),v()}function u(e){var t=o(e);return t?t.format("MM/DD/YYYY HH:mm"):""}function d(t,n){i(function(){e.isReportLoading=!0,null==f&&(f=r.getBulkImportReportPoller()).promise.then(null,null,function(t){if(200===t.status){var i=t.data;0==i.processing&&(e.uploadReport=i,f&&(f.stop(),f=null),e.isReportLoading=!1)}else a.error(t)})},0)}function m(t){i(function(){e.isReportLoading=!1},0)}var f=null;e.formatDate=u,e.inputUploadElement,e.isFileUploading=!1,e.isReportLoading=!1,e.progressValue=0,e.uploadFileName=null,e.uploadReport=null;var p=e.$on(c.uploadSuccess,d),v=e.$on(c.uploadFailed,m);e.$on("$destroy",s)}return{restrict:"E",scope:{uploadUrl:"="},replace:!0,templateUrl:"/views/devices/bulkUploadTemplate.html",link:u}}function deviceFilter(e,t,i,a,n){function o(i,o,r,l){function s(){angular.extend(i,E)}function c(){i.searchTerm=""}function u(e,t){return e.some(function(e){return t.includes(e)})}function d(){N(),angular.forEach(h,function(t,i){e.search(t,null)})}function m(){var e=[];angular.forEach(i.stations,function(t,a){t.custom.lineNames&&u(t.custom.lineNames,i.filterLineSelected)&&e.push(t)});var t=[];angular.forEach(e,function(e,a){i.filterStationSelected.includes(e.name)&&t.push(e.name)}),i.filteredStations=e,i.filterStationSelected=t}function f(e,t){return a.filterData||(a.filterData={}),a.filterData[e]}function p(e,t){return"filterLineSelected"==t||"filterStationSelected"==t?angular.isArray(e)||(e=[e]):("false"==e&&(e=!1),"true"==e&&(e=!0)),e}function v(e,t){a.filterData||(a.filterData={}),a.filterData[e]=t}function g(e,t){i.mapId&&n.getMap(i.mapId).then(function(i){i.setView(e,t)})}function S(i,a,n){t(function(){var t={},a=!1;angular.forEach(h,function(n,o){t[n]=i[o],e.search(n,i[o]),a=a||JSON.stringify(E[n])!==JSON.stringify(t[n])}),v("filters",t),n.callbackFn&&n.callbackFn({filters:t,isActive:a})},0)}var E={filterAreaSelected:null,filterLineSelected:[],filterStationSelected:[],filterStatusProduction:!0,filterStatusNoProduction:!0,filterStatusError:!0,filterStatusWarning:!0,filterStatusMaintenance:!0,filterStatusOk:!0},h=["filterAreaSelected","filterStationSelected","filterLineSelected","filterStatusProduction","filterStatusNoProduction","filterStatusError","filterStatusWarning","filterStatusMaintenance","filterStatusOk"];i.clearFilters=s,i.clearSearchTerm=c,i.filterAreaSelected,i.filteredStations=[],i.filterLineSelected=[],i.filterStations=m,i.filterStationSelected=[],i.filterStatusProduction,i.filterStatusError,i.filterStatusWarning,i.filterStatusMaintenance,i.filterStatusOk,i.linkAreaSelected,i.linkLineSelected,i.setMapView=g,i.searchTerm,i.STATION_UNDEFINED="MR-UNDEFINED",angular.extend(i,E);var N=i.$watchGroup(h,S);i.$on("$destroy",d),function(){angular.extend(i,f("filters")),angular.forEach(h,function(t,a){var n=e.search()[t];n&&(n=p(n,t),i[t]=n)})}()}return{restrict:"E",scope:{mapId:"=",areas:"=",lines:"=",stations:"=",callbackFn:"&",quickLinksEnabled:"=",isAuthorized:"=authorized"},replace:!0,templateUrl:"/views/devices/filterTemplate.html",link:o}}function deviceStatus(e,t,i,a,n,o,r){function l(e,t,a,n){function r(e,t){var i=null;return e&&t&&(i=e.find(function(e){return e.name==t})),i}e.isDoubleFace=!1,e.isError=!1,e.MODE_LIST="list",e.search=r,e.status={},function(){e.isDoubleFace=e.device.custom.screenshotUrl.length>1,o.getDeviceStatus(e.device.address).then(function(t){e.status=t}).catch(function(t){i.error(t),e.isError=!0})}()}return{restrict:"E",scope:{device:"=",mode:"=?"},replace:!0,templateUrl:"/views/devices/statusTemplate.html",link:l}}function deviceWizard(e,t,i,a,n,o,r){function l(e,l,s,c){function u(){e.device={},e.deviceWizardForm.$setPristine(),e.deviceWizardForm.$setUntouched()}function d(){D()}function m(i){var a=e.currentStation;return a?-1==i?"editMap":"editMap_"+a.name+"_floor_"+i:(t.error("No station found"),"")}function f(i){var a=e.currentStation;if(!a)return t.error("No station found"),"";if(-1==i)return e.stationImageBasePath+a.custom.position.mapUrl;var n=(a.custom.floors?a.custom.floors:[]).find(function(e){return e.name==i});return n?e.stationImageBasePath+n.position.mapUrl:(t.error("No image available for the current floor"),"")}function p(){function i(t,i){e.isFormSubmitting=!1,e.tabGoTo(e.TAB_BASE_INDEX),e.clearForm(),e.$emit(o.wizardSuccess,{data:t,message:i,closeSideBar:!0})}function n(i,a,n){t.error(i),e.isFormSubmitting=!1,e.$emit(o.wizardFailed,{message:a,description:n})}e.isFormSubmitting=!0,e.isNewDevice?a.createDevice(e.device).then(function(e){i(e,"DEVICE_CREATED")}).catch(function(e){t.error(e),n(e,e.data.error,e.data.description)}):a.updateDevice(e.device.name,e.device).then(function(e){i(e,"DEVICE_UPDATED")}).catch(function(e){n(e,e.data.error,e.data.description)})}function v(t,a){i(function(){e.device.config.position.lat=a.position.lat,e.device.config.position.lng=a.position.lng},0)}function g(t){if(e.device&&e.device.config){for(var i=t!=e.device.config.templateName,a=[],n={},o=e.device.config.templateName,r=0;r<e.templates.length;r++)if((c=e.templates[r]).name==o){a=c.custom.templateFields,n=c.config?c.config.templateFieldsValue:{},e.device.os=c.os,e.device.faces=c.faces;break}e.customFieldConfs=a,(e.isNewDevice||i)&&(e.device.config.templateFieldsValue=n);for(var l=[],s={},o=e.device.config.templateName,r=0;r<e.templates.length;r++){var c=e.templates[r];if(c.name==o){l=c.custom.templateServices,s=c.config?c.config.templateServicesValue:{};break}}e.customServiceConfs=l,e.isNewDevice||i?e.device.config.templateServicesValue=s:e.device.config.templateServicesValue=angular.merge({},s,e.device.config.templateServicesValue)}}function S(t){if(e.device&&e.device.config){for(var i=e.device.config.stationName,a=[],n=0;n<e.stations.length;n++){var o=e.stations[n];if(o.name==i){e.currentStation=o,a=o.custom.floors;break}}e.stationFloors=a}}function E(){var i=e.device.address;a.getDeviceConfig(i).then(function(t){e.device.displayName=t.name,e.device.config.serialNumber=t.serial,e.device.config.model=t.model,e.device.notes=t.notes,e.$emit(o.wizardSuccess,{message:"DEVICE_CONFIGURATED"})}).catch(function(i){t.error(i),e.$emit(o.wizardFailed,{message:i.data.error,description:i.data.description})})}function h(t){e.tabCurrentIndex=t}function N(){var t=e.tabCurrentIndex==e.tabMaxIndex?0:e.tabCurrentIndex+1;e.tabCurrentIndex=t}function $(){var t=0==e.tabCurrentIndex?0:e.tabCurrentIndex-1;e.tabCurrentIndex=t}e.clearForm=u,e.currentStation=null,e.customFieldConfs=[],e.customServiceConfs=[],e.device={},e.excludeAddresses=[],e.excludeNames=[],e.getDeviceConfiguration=E,e.handleSubmit=p,e.isFormSubmitting=!1,e.isNewDevice=!0,e.getFloorMapId=m,e.getFloorImageOverlayUrl=f,e.mapEditCenter={lat:50,lng:50,zoom:1},e.mapEditMarkers={},e.mapImagePath=r.mapImagePath,e.numberPattern=/^-?[0-9]+([.][0-9]+)?$/,e.onStationChange=S,e.onTemplateChange=g,e.TAB_BASE_INDEX=0,e.TAB_CUSTOM_INDEX=2,e.TAB_MAP_INDEX=1,e.tabCurrentIndex=0,e.tabMaxIndex=2,e.tabGoTo=h,e.tabGoToNext=N,e.tabGoToPrev=$,e.STATION_UNDEFINED="MR-UNDEFINED",e.stationImageBasePath=r.stationImageBasePath,e.stationFloors=[];var D=e.$on(n.markerDragEnd,v);e.$on("$destroy",d),function(){var t={config:{production:!0,position:{displayName:"device",lat:50,lng:50},stationFloorId:-1},previousTemplateName:null,previousStationName:null};if(e.deviceDefaults&&e.deviceDefaults.name&&(e.isNewDevice=!1),angular.merge(e.device,t,e.deviceDefaults),e.isNewDevice)e.device.config.maintainerGroupIds=e.groups.map(function(e){return e.id});else{e.device.previousTemplateName=e.device.config.templateName,e.device.previousStationName=e.device.config.stationName;var i=e.groups.filter(function(t){return e.device.config.maintainerGroupIds.includes(t.id)});e.device.config.maintainerGroupIds=i.map(function(e){return e.id})}e.mapEditMarkers.device={lat:e.device.config.position.lat,lng:e.device.config.position.lng,title:e.device.config.position.displayName,focus:!0,draggable:!0},angular.forEach(e.devices,function(t){t.address!=e.device.address&&e.excludeAddresses.push(t.address.trim().toLowerCase()),t.displayName!=e.device.displayName&&e.excludeNames.push(t.displayName.trim().toLowerCase())}),g(e.device.config.templateName),S(e.device.config.stationName)}()}return{restrict:"E",scope:{deviceDefaults:"=?",groups:"=",devices:"=",stations:"=",templates:"=",isAuthorized:"=authorized"},replace:!0,templateUrl:"/views/devices/wizardTemplate.html",link:l}}function errSrc(){function e(e,t,i,a){e.$on("$destroy",function(){t.off("error")}),t.on("error",function(){i.src!=i.errSrc&&i.$set("src",i.errSrc)})}return{restrict:"A",link:e}}function excludeValues(e){function t(e,t,i,a){a.$validators.excludeValues=function(t){return!t||!e.excludeValues.includes(t.trim().toLowerCase())},e.$watch("excludeValues",function(){a.$validate()})}return{require:"ngModel",scope:{excludeValues:"=excludeValues"},link:t}}function fileUpload(e,t,i,a,n,o,r,l){function s(t,a,n,s){function c(){t.isFileUploading=!1,t.progressValue=0,t.inputUploadElement&&t.inputUploadElement.off("change")}function u(e){t.progressValue=0;var i=e.target?e.target.files:[];s.$setViewValue(i,e),!s.$invalid&&i.length>0&&(o.upload(t.uploadUrl,i,f,m,d),t.isFileUploading=!0)}function d(a){i(function(){t.$emit(l.uploadFailed,{idx:t.idx,name:t.name,message:a.data.error,description:a.data.description}),s.$setViewValue(null),t.inputUploadElement[0].value="",t.isFileUploading=!1,e.$broadcast(r.appErrorNotify,{message:a.data.error,description:a.data.description})},0)}function m(a){i(function(){t.$emit(l.uploadSuccess,{idx:t.idx,name:t.name,response:a}),t.inputUploadElement[0].value="",t.isFileUploading=!1,e.$broadcast(r.appSuccessNotify,{message:"FILE_UPLOADED"})},0)}function f(e){i(function(){var i=0;e.lengthComputable&&(i=Math.round(e.loaded/e.total*100)),t.progressValue=i},0)}t.inputUploadElement,t.isFileUploading=!1,t.name=angular.isDefined(t.name)?t.name:"upload-input",t.progressValue=0,t.$on("$destroy",c),function(){var e=a.find("input");if(e){if(t.inputUploadElement=e,e.on("change",u),n.maxsize){var i=parseInt(n.maxsize);s.$validators.maxsize=function(e,t){var a=e||t;if(angular.isUndefined(a)||null===a)return!0;for(var n=a.length-1;n>=0;n--)if(a[n]&&a[n].size&&a[n].size>i)return!1;return!0}}if(n.accept){var o=n.accept.split(",").map(function(e){return e.trim()});s.$validators.accept=function(e,t){var i=e||t;if(angular.isUndefined(i)||null===i)return!0;for(var a=i.length-1;a>=0;a--)if(i[a]&&-1===o.indexOf(i[a].type))return!1;return!0}}}}()}return{restrict:"E",scope:{idx:"@",name:"@?",uploadUrl:"=",accept:"@?"},replace:!0,templateUrl:"/views/fileUploadTemplate.html",require:"ngModel",link:s}}function leaflet(e,t,i,a,n,o,r){function l(e,t,i,l){function s(){p.remove(),p=null}function c(e){return n["leafletData_"+f]||(n["leafletData_"+f]={}),n["leafletData_"+f][e]}function u(e,t){n["leafletData_"+f]||(n["leafletData_"+f]={}),n["leafletData_"+f][e]=t}function d(){v?(v.clearLayers(),angular.forEach(e.markers,function(t,i){var a=L.marker([t.lat,t.lng],{title:t.title,draggable:t.draggable||!1,focus:t.focus||!1});if(t.icon){var n=null;switch(t.icon.type){case"div":n=L.divIcon(t.icon);break;default:n=L.icon(t.icon)}a.setIcon(n)}if(t.popupHtml){o=L.popup().setContent(t.popupHtml);a.bindPopup(o,{maxWidth:"auto"})}else if(t.popupTemplate){var o=L.popup.angular({template:t.popupTemplate}).setContent(t.popupContent);a.bindPopup(o,{maxWidth:"auto"})}a.on("mouseover",function(e){this.openPopup()}),t.draggable&&a.on("dragend",function(t){var i=t.target,a=i.getLatLng();e.$emit(r.markerDragEnd,{marker:i,position:a})}),a.private=t.private,v.addLayer(a)})):a.warn("leafletDirective: MarkerLayer not ready")}var m=e.saveMapState,f=e.mapId,p=null,v=null;e.$watch("markers",d),e.$on("$destroy",s),function(){var i={lat:50,lng:50,zoom:4};if(angular.extend(i,e.center),m&&angular.extend(i,c("center")),p=L.map(t[0],{crs:L.CRS.Simple,maxZoom:7,minZoom:3}),e.imageOverlayUrl){var n=new Image;n.onload=function(t){var a=this.width/this.height,n=[[0,0],[100,100*a]];p.setView([i.lat,i.lng*a],i.zoom),p.setMaxBounds(n),L.imageOverlay(e.imageOverlayUrl,n).setOpacity(.9).addTo(p)},n.src=e.imageOverlayUrl}else a.error('directive:leaflet: No "imageOverlayUrl" defined');var r=e.markerCluster;r?(v=L.markerClusterGroup(r),r.clusterMouseOverFunction&&v.on("clustermouseover",r.clusterMouseOverFunction)):v=new L.FeatureGroup,p.addLayer(v),p.on("moveend",function(e){m&&u("center",{lat:p.getCenter().lat,lng:p.getCenter().lng,zoom:p.getZoom()})}),o.setMap(p,f)}()}return{restrict:"E",scope:{mapId:"=",center:"=",imageOverlayUrl:"=",markers:"=",markerCluster:"=",saveMapState:"="},replace:!0,template:'<div class="map"></div>',link:l}}function refreshOnIdle(){function e(e,t,i,a){function n(){c&&(clearTimeout(c),c=null),window.removeEventListener("focus",r,!1),window.removeEventListener("blur",r,!1),window.removeEventListener("click",r,!1),window.removeEventListener("mousemove",r,!1),window.removeEventListener("keypress",r,!1)}function o(){(new Date).getTime()-s>=l?window.location.reload(!0):c=setTimeout(o,l)}function r(){s=(new Date).getTime()}var l=6e4,s=(new Date).getTime(),c=null;e.$on("$destroy",n),c=setTimeout(o,6e5),window.addEventListener("focus",r,!1),window.addEventListener("blur",r,!1),window.addEventListener("click",r,!1),window.addEventListener("mousemove",r,!1),window.addEventListener("keypress",r,!1)}return{restrict:"A",link:e}}function stationWizard(e,t,i,a,n,o,r,l){function s(e,s,c,u){function d(){var t=e.station.custom.floors.length;e.station.custom.floors.push({isNew:!0,position:{displayName:"Floor "+(t+1),lat:e.station.custom.position.lat,lng:e.station.custom.position.lng},uploadTempFileName:void 0}),e.floorsUploadFileName[t]=void 0}function m(){e.station={},e.stationWizardForm.$setPristine(),e.stationWizardForm.$setUntouched()}function f(t){if(e.station.custom.floors.length>t){var i=e.station.custom.floors[t];e.station.custom.floors.splice(t,1),e.floorsUploadFileName.splice(t,1),i.isNew||e.station.deletedFloors.push(i),delete e.stationWizardForm["uploadInput-"+t]}}function p(){h(),N()}function v(){function i(t,i){e.isFormSubmitting=!1,e.clearForm(),e.$emit(o.wizardSuccess,{data:t,message:i,closeSideBar:!0})}function n(i,a,n){t.error(i),e.isFormSubmitting=!1,e.$emit(o.wizardFailed,{message:a,description:n})}e.isFormSubmitting=!0,e.isNewStation?a.createStation(e.station).then(function(e){i(e,"STATION_CREATED")}).catch(function(e){t.error(e),n(e,e.data.error,e.data.description)}):a.updateStation(e.station.name,e.station).then(function(e){i(e,"STATION_UPDATED")}).catch(function(e){n(e,e.data.error,e.data.description)})}function g(t){i(function(){e.isTabVisible=!0},100)}function S(t,i){if(i){var a=i.idx,n=-1==a?e.station:e.station.custom.floors[a],o=i.response;o&&o.data?n.uploadTempFileName=o.data.fileName:n.uploadTempFileName=void 0}}function E(t,a){i(function(){e.station.custom.position.lat=a.position.lat,e.station.custom.position.lng=a.position.lng},0)}e.addFloor=d,e.clearForm=m,e.deleteFloor=f,e.excludeNames=[],e.handleSubmit=v,e.imageBasePath=l.imageBasePath,e.isFormSubmitting=!1,e.isNewStation=!0,e.isTabVisible=!1,e.floorsUploadFileName=[],e.mapEditCenter={lat:50,lng:50,zoom:1},e.mapEditId="editStationMap",e.mapEditMarkers={},e.mapImagePath=l.mapImagePath,e.onTabSelected=g,e.station={},e.stationImageBasePath=l.stationImageBasePath,e.TAB_BASE_INDEX=0,e.tabCurrentIndex=0,e.tempBasePath=l.tempBasePath,e.uploadUrl="stations/image/upload",e.uploadFileName=void 0;var h=e.$on(n.markerDragEnd,E),N=e.$on(r.uploadSuccess,S);e.$on("$destroy",p),function(){var t={custom:{position:{displayName:"station",lat:50,lng:50},type:"LEVEL2",filterable:!0,floors:[],deletedFloors:[]},uploadTempFileName:void 0};e.stationDefaults&&e.stationDefaults.name&&(e.isNewStation=!1),angular.merge(e.station,t,e.stationDefaults),angular.forEach(e.station.custom.floors,function(t,i){var a={isNew:!1,isDeleted:!1,position:{displayName:"Floor "+(i+1),lat:e.station.custom.position.lat,lng:e.station.custom.position.lng},uploadTempFileName:void 0};t=angular.merge(t,a),e.floorsUploadFileName[i]=void 0}),e.mapEditMarkers.station={lat:e.station.custom.position.lat,lng:e.station.custom.position.lng,title:e.station.custom.position.displayName,focus:!0,draggable:!0},angular.forEach(e.stations,function(t){t.displayName!=e.station.displayName&&e.excludeNames.push(t.displayName.trim().toLowerCase())})}()}return{restrict:"E",scope:{stationDefaults:"=?",lines:"=",stations:"="},replace:!0,templateUrl:"/views/stations/wizardTemplate.html",link:s}}function statusSummary(e,t,i,a,n){function o(e,t,i,a){}return{restrict:"E",scope:{data:"="},replace:!0,templateUrl:"/views/summaryTemplate.html",link:o}}compareTo.$inject=["$log"],deviceBulkUpload.$inject=["$rootScope","$location","$timeout","$log","$localStorage","moment","devicesService","fileUploadService","APPLICATION_EVENTS","FILE_UPLOAD_EVENTS"],deviceFilter.$inject=["$location","$timeout","$log","$localStorage","leafletService"],deviceStatus.$inject=["$location","$timeout","$log","$localStorage","$rootScope","devicesService","APPLICATION_EVENTS"],deviceWizard.$inject=["$rootScope","$log","$timeout","devicesService","LEAFLET_EVENTS","WIZARD_EVENTS","PATHS"],excludeValues.$inject=["$log"],fileUpload.$inject=["$rootScope","$location","$timeout","$log","$localStorage","fileUploadService","APPLICATION_EVENTS","FILE_UPLOAD_EVENTS"],leaflet.$inject=["$rootScope","$location","$timeout","$log","$localStorage","leafletService","LEAFLET_EVENTS"],stationWizard.$inject=["$rootScope","$log","$timeout","stationsService","LEAFLET_EVENTS","WIZARD_EVENTS","FILE_UPLOAD_EVENTS","PATHS"],statusSummary.$inject=["$location","$timeout","$log","$rootScope","APPLICATION_EVENTS"];var directivesDomain=angular.module("SolariMonitor.directives",[]);directivesDomain.directive("compareTo",compareTo),directivesDomain.directive("deviceBulkUpload",deviceBulkUpload),directivesDomain.directive("deviceFilter",deviceFilter),directivesDomain.directive("deviceStatus",deviceStatus),directivesDomain.directive("deviceWizard",deviceWizard),directivesDomain.directive("errSrc",errSrc),directivesDomain.directive("excludeValues",excludeValues),directivesDomain.directive("fileUpload",fileUpload),directivesDomain.directive("leaflet",leaflet),directivesDomain.directive("refreshOnIdle",refreshOnIdle),directivesDomain.directive("stationWizard",stationWizard),directivesDomain.directive("statusSummary",statusSummary);
//# sourceMappingURL=maps/directives.min.js.map
